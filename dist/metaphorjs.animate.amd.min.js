define("metaphorjs-animate",["metaphorjs-promise"],function(H){var y=function(){var b=["Moz","Webkit","ms","O","Khtml"],a="animationDelay",d="animationDuration",p="transitionDelay",e="transitionDuration",c=null;(function(){var c=document.createElement("div"),g=!1,h,m,f;if(void 0!==c.style.animationName)g=!0;else for(m=0,f=b.length;m<f;m++)if(h=b[m],void 0!==c.style[h+"AnimationName"]){g=!0;a=h+"AnimationDelay";d=h+"AnimationDuration";p=h+"TransitionDelay";e=h+"TransitionDuration";break}return g})()&&
(c={animationDelay:a,animationDuration:d,transitionDelay:p,transitionDuration:e});return function(){return c}}(),J=function(){var b=function(a){if(!a)return 0;var b=parseFloat(a);-1==a.indexOf("ms")&&(b*=1E3);return b},a=function(a,d,m){var f,e,c=d.length;for(f=0;f<c;f++)e=b(d[f])+b(m[f]),a=Math.max(e,a);return a},d=y(),p=d?d.animationDuration:null,e=d?d.animationDelay:null,c=d?d.transitionDuration:null,k=d?d.transitionDelay:null;return function(b){if(!d)return 0;var h=window.getComputedStyle?window.getComputedStyle(b,
null):b.style;b=0;var m=(h[p]||"").split(","),f=(h[e]||"").split(","),I=(h[c]||"").split(","),h=(h[k]||"").split(",");b=Math.max(b,a(b,m,f));return b=Math.max(b,a(b,I,h))}}(),K=function(){var b=["0","0","0"];return function(){for(var a=b.length,d;a;){a--;d=b[a].charCodeAt(0);if(57==d)return b[a]="A",b.join("");if(90==d)b[a]="0";else return b[a]=String.fromCharCode(d+1),b.join("")}b.unshift("0");return b.join("")}}(),r=function(b){return"undefined"==typeof b},k=function(){var b={};return function(a,
d,k){a=a._mjsid||(a._mjsid=K());var e=b[a];if(r(k))return e?e[d]:void 0;e||(e=b[a]={});return e[d]=k}}(),z=function(){var b={};return function(a){return b[a]||(b[a]=new RegExp(a))}}(),u=function(b,a){a&&(b.className=b.className.replace(z("(?:^|\\s)"+a+"(?!\\S)"),""))},w=function(b){return"function"===typeof b},L=function(b){var a=k(b,"mjsAnimationQueue"),d;D(a)&&a.length?(d=a[0])&&d.stages&&(a=d.position,d=d.stages,u(b,d[a]),u(b,d[a]+"-active")):w(a)?a(b):"stop"==a&&$(b).stop(!0,!0);k(b,"mjsAnimationQueue",
null)},M=Object.prototype.toString,D=function(b){var a;if(a=b&&null!=b&&"object"===typeof b)a=b.length,a="number"==typeof a&&!isNaN(a);return!(!a||"[object Array]"!=M.call(b))},E=function(b){var a;return b&&(null!=b&&"object"===typeof b||w(b))?w(a=b.then)?a:!1:!1},N=Array.prototype.slice,A=function(b){return!(!b||b.constructor!==Object)},F=function a(){var d=!1,k=!1,e=N.call(arguments),c=e.shift(),v,g,h;"boolean"==typeof e[e.length-1]&&(d=e.pop());"boolean"==typeof e[e.length-1]&&(k=d,d=e.pop());
for(;e.length;)if(v=e.shift())for(g in v)if(v.hasOwnProperty(g)&&!r(h=v[g]))if(k)if(c[g]&&A(c[g])&&A(h))a(c[g],h,d,k);else{if(!0===d||r(c[g])||null===c[g])A(h)?(c[g]={},a(c[g],h,d,!0)):c[g]=h}else if(!0===d||r(c[g])||null===c[g])c[g]=h;return c},G=function(a,d){return d?z("(?:^|\\s)"+d+"(?!\\S)").test(a.className):!1};return function(){var a={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},d=0,p=!!y(),e=window.requestAnimationFrame?window.requestAnimationFrame:
function(a){window.setTimeout(a,0)},c=function(a,d,f){var c=function(){(new Date).getTime()-d>=f?a():e(c)};e(c)},v=function m(a,d,g,p,l,w,r){var x=function(){var d=k(a,"mjsAnimationQueue");return d&&d.length&&d[0].id==r?!1:(l.reject(a),!0)},q=function(){if(!x()){var e=g;g++;if(g==d.length){l.resolve(a);k(a,"mjsAnimationQueue").shift();var c=k(a,"mjsAnimationQueue");c.length?(c=c[0],v(c.el,c.stages,0,c.start,c.deferred,!1,c.id)):k(a,"mjsAnimationQueue",null)}else k(a,"mjsAnimationQueue")[0].position=
g,m(a,d,g,null,l);u(a,d[e]);u(a,d[e]+"-active")}},n=function(){if(!x()){var e=d[g]+"-active";e&&!G(a,e)&&(a.className+=" "+e);(e=J(a))?c(q,(new Date).getTime(),e):q()}},t=function(){if(!x()){var c=d[g];c&&!G(a,c)&&(a.className+=" "+c);var m;p&&(m=p(a),p=null);E(m)?m.done(n):e(n)}};w?e(t):t()},g=function(c,f,e,g,r){var l=new H,u=k(c,"mjsAnimationQueue")||[],y=++d,x=c.getAttribute("mjs-animate"),q,n,t,B,s,z,C;f=f||x;g&&null===x&&(f=null);if(f){"string"==typeof f?"["==f.substr(0,1)?q=(new Function("",
"return "+f))():(q=a[f],f=r&&r.get("animate."+f,!0)):w(f)?n=f:D(f)&&("string"==typeof f[0]?q=f:(t=f[0],B=f[1]));A(f)&&(q=f.stages,n=f.fn,t=f.before,B=f.after,s=f.options?F({},f.options):{},z=f.context||null,C=f.duration||null,e=e||s.start);if(p&&q)return u.push({el:c,stages:q,start:e,deferred:l,position:0,id:y}),k(c,"mjsAnimationQueue",u),1==u.length&&v(c,q,0,e,l,!0,y),l;s=s||{};e&&(s.start=function(){e(c)});s.complete=function(){l.resolve(c)};C&&(s.duration=C);if(n&&w(n))return t&&F(c.style,t,!0,
!1),e&&e(c),k(c,"mjsAnimationQueue",n.call(z,c,function(){l.resolve(c)})),l;if(window.jQuery){f=$(c);t&&f.css(t);k(c,"mjsAnimationQueue","stop");if(n&&"string"==typeof n)return f[n](s),l;if(B)return f.animate(B,s),l}}e?(n=e(c),E(n)?n.done(function(){l.resolve(c)}):l.resolve(c)):l.resolve(c);return l};g.addAnimationType=function(c,d){a[c]=d};g.stop=L;return g}()});
