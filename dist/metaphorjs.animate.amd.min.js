define("metaphorjs-animate",["metaphorjs-promise"],function(D){var A=function(){var a=["Moz","Webkit","ms","O","Khtml"],b="animationDelay",c="animationDuration",f="transitionDelay",d="transitionDuration",m="transform",n=null,l=null;(function(){var g=document.createElement("div"),e=!1,p,l,k;if(void 0!==g.style.animationName)e=!0;else for(l=0,k=a.length;l<k;l++)if(p=a[l],void 0!==g.style[p+"AnimationName"]){e=!0;b=p+"AnimationDelay";c=p+"AnimationDuration";f=p+"TransitionDelay";d=p+"TransitionDuration";
m=p+"Transform";break}e&&("ontransitionend"in window?n="transitionend":"onwebkittransitionend"in window&&(n="webkitTransitionEnd"));return e})()&&(l={animationDelay:b,animationDuration:c,transitionDelay:f,transitionDuration:d,transform:m,transitionend:n});return function(){return l}}(),L=function(){var a=function(a){if(!a)return 0;var b=parseFloat(a);-1==a.indexOf("ms")&&(b*=1E3);return b},b=function(b,c,e){var p,d,f=c.length;for(p=0;p<f;p++)d=a(c[p])+a(e[p]),b=Math.max(d,b);return b},c=A(),f=c?c.animationDuration:
null,d=c?c.animationDelay:null,m=c?c.transitionDuration:null,n=c?c.transitionDelay:null;return function(a){if(!c)return 0;var g=window.getComputedStyle?window.getComputedStyle(a,null):a.style;a=0;var e=(g[f]||"").split(","),p=(g[d]||"").split(","),k=(g[m]||"").split(","),g=(g[n]||"").split(",");a=Math.max(a,b(a,e,p));return a=Math.max(a,b(a,k,g))}}(),M=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]=
"0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),k=function(){var a={};return function(b,c,f){b=b._mjsid||(b._mjsid=M());var d=a[b];return void 0!==f?(d||(d=a[b]={}),d[c]=f):d?d[c]:void 0}}(),H=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),t=function(a,b){b&&(a.className=a.className.replace(H("(?:^|\\s)"+b+"(?!\\S)"),""))},B=function(a){return"function"==typeof a},N=Object.prototype.toString,E=function(){var a={"[object String]":0,
"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[N.call(b)];return void 0===c?-1:1==c&&isNaN(b)?8:c}}(),O=function(a){var b=k(a,"mjsAnimationQueue"),c,f;if("object"==typeof b&&5===E(b)&&b.length){if(b=b[0])b.stages&&(c=b.position,f=b.stages,t(a,f[c]),t(a,f[c]+"-active")),b.deferred&&b.deferred.reject(b.el)}else B(b)?b(a):"stop"==
b&&$(a).stop(!0,!0);k(a,"mjsAnimationQueue",null)},P=function(a){if(!a||!a.then)return!1;var b,c;return"object"!=(c=typeof a)&&"function"!=c?!1:B(b=a.then)?b:!1},Q=Array.prototype.slice,C=function(a){return"object"==typeof a&&3===E(a)&&!a.nodeType},I=function(a){return!0===a||!1===a},J=function(){return function b(){var c=!1,f=!1,d=Q.call(arguments),m=d.shift(),k,l,g;I(d[d.length-1])&&(c=d.pop());I(d[d.length-1])&&(f=c,c=d.pop());for(;d.length;)if(k=d.shift())for(l in k)if(k.hasOwnProperty(l)&&void 0!==
(g=k[l]))if(f)if(m[l]&&C(m[l])&&C(g))b(m[l],g,c,f);else{if(!0===c||void 0==m[l])C(g)?(m[l]={},b(m[l],g,c,!0)):m[l]=g}else if(!0===c||void 0==m[l])m[l]=g;return m}}(),K=function(a,b){var c;if(c=b)c=!(b&&H("(?:^|\\s)"+b+"(?!\\S)").test(a.className));c&&(a.className+=" "+b)},F=function(a){return"string"==typeof a||a===""+a},v=function(){var a,b;if("undefined"!=typeof window){var c=window;a=c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame;b=c.cancelAnimationFrame||c.webkitCancelAnimationFrame||
c.mozCancelAnimationFrame||c.webkitCancelRequestAnimationFrame;if(a)return function(c){var d=a(c);return function(){b(d)}}}return function(a){var b=setTimeout(a,0);return function(){clearTimeout(b)}}}();return function(){var a={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},b=0,c=A(),f=!!c,d=function(a,b,e){var c=function(){(new Date).getTime()-b>=e?a():v(c)};v(c)},m=function g(a,b,f,n,y,q,z,w){var x=function(){var b=k(a,"mjsAnimationQueue");return b&&
b.length&&b[0].id==z?!1:(y.reject(a),!0)},s=function(){if(c.transitionend){var d=c.transitionend,h=s;a.detachEvent?a.detachEvent("on"+d,h):a.removeEventListener(d,h,!1)}x()||(d=f,f++,f==b.length?(y.resolve(a),k(a,"mjsAnimationQueue").shift(),h=k(a,"mjsAnimationQueue"),h.length?(h=h[0],m(h.el,h.stages,0,h.start,h.deferred,!1,h.id,h.step)):k(a,"mjsAnimationQueue",null)):(k(a,"mjsAnimationQueue")[0].position=f,g(a,b,f,null,y,!1,z,w)),t(a,b[d]),t(a,b[d]+"-active"))},r=function(){x()||(K(a,b[f]+"-active"),
D.resolve(w&&w(a,f,"active")).done(function(){if(!x()){var b=L(a);if(b)if(c.transitionend){var b=c.transitionend,g=s;a.attachEvent?a.attachEvent("on"+b,g):a.addEventListener(b,g,!1)}else d(s,(new Date).getTime(),b);else v(s)}}))},u=function(){x()||(K(a,b[f]),D.waterfall([w&&w(a,f,"start"),function(){return n?n(a):null}]).done(function(){!x()&&v(r)}))};q?v(u):u()},n=function(c,e,d,n,v,y){var q=new D,z=k(c,"mjsAnimationQueue")||[],w=++b,x=c.getAttribute("mjs-animate"),s,r,u,t,h,A,G;e=e||x;n&&null===
x&&(e=null);if(e){F(e)?"["==e.substr(0,1)?s=(new Function("","return "+e))():(s=a[e],e=v&&v.get("animate."+e,!0)):B(e)?r=e:"object"==typeof e&&5===E(e)&&(F(e[0])?s=e:(u=e[0],t=e[1]));C(e)&&(s=e.stages,r=e.fn,u=e.before,t=e.after,h=e.options?J({},e.options):{},A=e.context||null,G=e.duration||null,d=d||h.start);if(f&&s)return z.push({el:c,stages:s,start:d,step:y,deferred:q,position:0,id:w}),k(c,"mjsAnimationQueue",z),1==z.length&&m(c,s,0,d,q,!0,w,y),q;h=h||{};d&&(h.start=function(){d(c)});h.complete=
function(){q.resolve(c)};G&&(h.duration=G);if(r&&B(r))return u&&J(c.style,u,!0,!1),d&&d(c),k(c,"mjsAnimationQueue",r.call(A,c,function(){q.resolve(c)})),q;if(window.jQuery){e=$(c);u&&e.css(u);k(c,"mjsAnimationQueue","stop");if(r&&F(r))return e[r](h),q;if(t)return e.animate(t,h),q}}d?(r=d(c),P(r)?r.done(function(){q.resolve(c)}):q.resolve(c)):q.resolve(c);return q};n.addAnimationType=function(b,c){a[b]=c};n.stop=O;n.prefixes=c;n.cssAnimations=f;return n}()});
